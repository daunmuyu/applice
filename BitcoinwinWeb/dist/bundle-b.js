!function(r){var o={};function i(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return r[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=r,i.c=o,i.d=function(e,n,r){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(n,e){if(1&e&&(n=i(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var o in n)i.d(r,o,function(e){return n[e]}.bind(null,o));return r},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i(i.s=5)}([function(e,n,r){"use strict";r.d(n,"a",function(){return o});var o=(i.serverUrl="",i.serverTestUrl="",i.canDebug=!1,i.localmainhtml="",i.zipfile="",i.versionfile="",i.reOpenAppForMinutes=0,i);function i(){}for(var t in o)window[t]&&(o[t]=window[t])},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ConfigReader});var _GlobalDefines__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),ConfigReader=function(){function ConfigReader(){this._showed_readConfig_err=!1}return ConfigReader.prototype.run=function(param){var _this=this;if(_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.serverUrl)this.onSuccessed&&this.onSuccessed.run(null);else{if(window.api.pageParam&&window.api.pageParam.serverUrl)return _GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.serverUrl=window.api.pageParam.serverUrl,void(this.onSuccessed&&this.onSuccessed.run(null));var model=window.api.require("kLine");model.getConfig(function(ret,err){if(ret){if(eval("ret="+ret.content),Array.isArray(ret)){if(_this.onTestServerUrl)return void _this.onTestServerUrl.run(ret);ret=ret[0]}_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.serverUrl=ret.packageUrl,window.api.setPrefs({key:"read_serverurl",value:_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.serverUrl}),window.api.setPrefs({key:"read_serverurl_config",value:JSON.stringify(ret)}),_this.onSuccessed&&_this.onSuccessed.run(null)}else{if(_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.serverUrl=window.api.getPrefs({sync:!0,key:"read_serverurl"}),_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.serverUrl)return void(_this.onSuccessed&&_this.onSuccessed.run(null));_this._showed_readConfig_err||(_this._showed_readConfig_err=!0,window.api.toast({msg:"Network error",duration:5e3,location:"bottom"})),window.setTimeout(function(){return _this.run(param)},1e3)}})}},ConfigReader}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return OpenAppWeb});var _GlobalDefines__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),OpenAppWeb=function(){function OpenAppWeb(){}return OpenAppWeb.prototype.run=function(param){if(_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.canDebug&&window.api.debug)return window.api.setKeepScreenOn({keepOn:!0}),void(this.onLoadFromInternet&&this.onLoadFromInternet.run(null));var versionFileContent=window.api.readFile({path:"fs://web2/version.txt",sync:!0});versionFileContent?(eval("versionFileContent="+versionFileContent),this.onSuccessed&&this.onSuccessed.run(versionFileContent)):this.onLoadFromLocalZip&&this.onLoadFromLocalZip.run(null)},OpenAppWeb}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CompareServerVersion});var _GlobalDefines__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),CompareServerVersion=function(){function CompareServerVersion(){}return CompareServerVersion.prototype.run=function(param){var _this=this,appVersionInfo=param,url=_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.serverUrl+"/"+_GlobalDefines__WEBPACK_IMPORTED_MODULE_0__.a.versionfile+"?t="+(new Date).getTime();window.api.ajax({url:url,method:"get",timeout:5,dataType:"text",cache:!1},function(ret,err){if(ret){eval("ret="+ret);var newVersion=ret.currentVersion,allowMinVersion=ret.minVersion;null!=allowMinVersion&&allowMinVersion||(allowMinVersion=-100);var curVersion=appVersionInfo.version,folder=appVersionInfo.folder;window.parseInt(curVersion)<parseInt(newVersion)?(folder="001"===folder?"002":"001",_this.onDownloadApp&&_this.onDownloadApp.run({newinfo:{folder:folder,version:newVersion},oldinfo:appVersionInfo,allowLocalVersion:window.parseInt(curVersion)>=allowMinVersion})):_this.onLoadApp&&_this.onLoadApp.run(appVersionInfo)}else-1==appVersionInfo.version?window.setTimeout(function(){return _this.run(param)},1e3):_this.onLoadApp&&_this.onLoadApp.run(appVersionInfo)})},CompareServerVersion}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return LoadFromLocalZip});var LoadFromLocalZip=function(){function LoadFromLocalZip(){}return LoadFromLocalZip.prototype.run=function(param){var _this=this,localversion=window.api.readFile({path:"widget://wgt/version.txt",sync:!0});if(localversion){eval("localversion="+localversion);var versionFileContent={version:localversion.currentVersion,folder:"001"},zip=window.api.require("zip");zip||alert("zip模块未被引用"),zip.unarchive({file:"widget://wgt/dist.zip",toPath:"fs://web2/001/"},function(e,n){n?alert(JSON.stringify(n)):_this.onSuccessed&&_this.onSuccessed.run(versionFileContent)})}else this.onSuccessed&&this.onSuccessed.run({version:-1,folder:"002"})},LoadFromLocalZip}()},function(e,n,r){"use strict";r.r(n);var c=r(1),d=(o.prototype.run=function(e){var t=this,n=!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),r=navigator.language?navigator.language:navigator.browserLanguage,a="请允许App读写手机内存及访问照片、媒体内容和文件权限，否则无法运行App!";r.indexOf("zh")<0&&(a="Please open the software to read and write the memory of mobile phone and access photos, media content and files."),n?this.onSuccessed&&this.onSuccessed.run(null):window.api.require("kLine").requestPermissions({permissions:["android.permission.WRITE_EXTERNAL_STORAGE","android.permission.READ_EXTERNAL_STORAGE"]},function(e,n){for(var r,o=0;o<e.result.length;o++){var i=e.result[o];if("android.permission.WRITE_EXTERNAL_STORAGE"==i.name){r=i;break}}r.granted?t.onSuccessed&&t.onSuccessed.run(null):(alert(a),window.api.closeWidget({silent:!0}))})},o);function o(){}var l=r(0),p=(i.prototype.run=function(e){try{var r;window.api.setPrefs({key:"_webFolder",value:"web2"}),window.api.addEventListener({name:"keyback"},function(e,n){window.api.sendEvent({name:"onBackKeyPressed"})}),window.api.setScreenOrientation({orientation:"portrait_up"}),window.api.setStatusBarStyle({style:"light"}),0<l.a.reOpenAppForMinutes&&(window.api.addEventListener({name:"resume"},function(e,n){((new Date).getTime()-r)/6e4>=l.a.reOpenAppForMinutes&&(window.api.require("kLine").close(),window.setTimeout(function(){window.api.rebootApp()},500))}),window.api.addEventListener({name:"pause"},function(e,n){r=(new Date).getTime()})),this.onSuccessed&&this.onSuccessed.run(null)}catch(e){alert(e.message)}},i);function i(){}var _=(t.prototype.run=function(e){window.api.openFrame({name:"main",url:l.a.serverTestUrl+"/"+(new Date).getTime()+"/"+l.a.localmainhtml,rect:{x:0,y:0,w:"auto",h:"auto"},bounces:!1,allowEdit:!0,useWKWebView:!0,bgColor:"rgba(0,0,0,0)",vScrollBarEnabled:!0,hScrollBarEnabled:!0,pageParam:{serverUrl:l.a.serverUrl,EncryptKey:"STTuU02NmZi9Ce1E76iWXdgE"}})},t);function t(){}var f=r(2),w=r(3),v=r(4),m=(a.prototype.run=function(e){window.api.openFrame({name:"main",url:"fs://web2/"+e.folder+"/"+l.a.localmainhtml,rect:{x:0,y:0,w:"auto",h:"auto"},allowEdit:!0,bounces:!1,useWKWebView:!0,bgColor:"rgba(0,0,0,0)",vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{serverUrl:l.a.serverUrl,EncryptKey:"STTuU02NmZi9Ce1E76iWXdgE",folder:e.folder}}),document.body.innerHTML=""},a);function a(){}var h=(s.prototype.run=function(e){window.api.removeLaunchView(),window.api.require("kLine").download?this.download(e):this.downloadWithApiCloud(e)},s.prototype.download=function(r){var o=this,i=window.api.require("zip");i||alert("zip模块未被引用");var t=document.body.querySelector("#divPercent");t||alert("页面缺少divPercent");var a=document.body.querySelector("#divPercentBg");a||alert("页面缺少divPercentBg");var s=document.body.querySelector("#divBg");s||alert("页面缺少divBg"),window.api.require("kLine").download({url:l.a.serverUrl+"/"+l.a.zipfile+"?t="+(new Date).getTime(),savePath:"fs://app.zip"},function(e,n){n?-1!=r.oldinfo.version&&r.allowLocalVersion?o.onSuccessed&&o.onSuccessed.run(r.oldinfo):setTimeout(function(){o.run(r)},1e3):2==e.status?(t.innerHTML="100%",s.style.width="100%",i.unarchive({file:"fs://app.zip",toPath:"fs://web2/"+r.newinfo.folder+"/"},function(e,n){e.status?o.writeVersion(r.newinfo):n&&alert(JSON.stringify(n))})):1==e.status&&(t.style.display="",a.style.display="",t.innerHTML="Connecting "+e.percent+"%",s.style.width=e.percent+"%")})},s.prototype.downloadWithApiCloud=function(r){var o=this,i=!1,t=window.api.require("zip");t||alert("zip模块未被引用");var a=document.body.querySelector("#divPercent");a||alert("页面缺少divPercent");var s=document.body.querySelector("#divPercentBg");s||alert("页面缺少divPercentBg");var u=document.body.querySelector("#divBg");u||alert("页面缺少divBg"),window.api.download({url:l.a.serverUrl+"/"+l.a.zipfile+"?t="+(new Date).getTime(),savePath:"fs://app.zip",report:!0,cache:!1,allowResume:!1},function(e,n){1==e.state?(a.innerHTML="100%",u.style.width="100%",t.unarchive({file:"fs://app.zip",toPath:"fs://web2/"+r.newinfo.folder+"/"},function(e,n){e.status?o.writeVersion(r.newinfo):n&&(i?alert(JSON.stringify(n)):-1!=r.oldinfo.version&&r.allowLocalVersion?o.onSuccessed&&o.onSuccessed.run(r.oldinfo):setTimeout(function(){o.run(r)},1e3))})):0!=e.state?-1!=r.oldinfo.version&&r.allowLocalVersion?o.onSuccessed&&o.onSuccessed.run(r.oldinfo):setTimeout(function(){o.run(r)},1e3):0==e.state&&(a.style.display="",s.style.display="",a.innerHTML="Connecting "+e.percent+"%",u.style.width=e.percent+"%",i=0<e.percent)})},s.prototype.writeVersion=function(r){var o=this;window.api.writeFile({path:"fs://web2/version.txt",data:JSON.stringify(r)},function(e,n){e.status?o.onSuccessed&&o.onSuccessed.run(r):n&&alert(n)})},s);function s(){}var b=(u.prototype.run=function(r){for(var o=this,i=0,t=!1,e=0;e<r.length;e++){var a=r[e];window.api.ajax({url:a.packageUrl+"/version.txt",method:"get"},function(e,n){if(i++,!t)if(e)t=!0,l.a.serverUrl=a.packageUrl,window.api.setPrefs({key:"read_serverurl",value:l.a.serverUrl}),window.api.setPrefs({key:"read_serverurl_config",value:JSON.stringify(a)}),o.onSuccessed&&o.onSuccessed.run(null);else if(n&&!t&&i>=e.length)return void window.setTimeout(function(){o.run(r)},500)})}},u);function u(){}window.apiready=function(){var e=new p,n=new d,r=new c.a,o=new b,i=new f.a,t=new _,a=new w.a,s=new v.a,u=new m,l=new h;((e.onSuccessed=n).onSuccessed=r).onSuccessed=i,((r.onTestServerUrl=o).onSuccessed=i).onLoadFromInternet=t,i.onSuccessed=a,((i.onLoadFromLocalZip=s).onSuccessed=a).onLoadApp=u,(a.onDownloadApp=l).onSuccessed=u,e.run(null)}}]);